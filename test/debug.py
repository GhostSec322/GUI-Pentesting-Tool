import pickle
import pandas as pd
from pprint import pprint

# PKL 파일 로드
report_path = "C:\\Users\\backd\\Desktop\\github\\GUI-Pentesting-Tool\\dasd\\report.pkl"

try:
    with open(report_path, "rb") as f:
        data = pickle.load(f)
except FileNotFoundError:
    print(f"File not found: {report_path}")
    exit(1)
except Exception as e:
    print(f"An error occurred while loading the PKL file: {e}")
    exit(1)

# 데이터 구조 확인
print("데이터 타입:", type(data))  # 데이터의 타입을 확인
print("\n데이터 내용:\n")
pprint(data)

# 딕셔너리 형태의 데이터가 들어왔다면 key-value 쌍을 정리
if isinstance(data, dict):
    for key, value in data.items():
        print(f"\n[ {key} ]")
        # value가 리스트인 경우
        if isinstance(value, list):
            # Check if list contains dictionaries
            if all(isinstance(item, dict) for item in value):
                df = pd.DataFrame(value)
                print(df)
            else:
                # List contains non-dict items
                for idx, item in enumerate(value, start=1):
                    print(f"{idx}. {item}")
        # value가 딕셔너리인 경우
        elif isinstance(value, dict):
            # Attempt to convert to DataFrame if possible
            if all(isinstance(v, (list, dict)) for v in value.values()):
                df = pd.DataFrame.from_dict(value, orient="index")
                print(df)
            else:
                # Pretty print the dictionary
                pprint(value)
        else:
            # Scalar value
            print(value)
else:
    print("Loaded data is not a dictionary.")
